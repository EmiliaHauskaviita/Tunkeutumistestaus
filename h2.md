# h2 Täysin Laillinen Sertifikaatti

## x) Lue/katso ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva kustakin artikkelista. Kannattaa lisätä myös jokin oma ajatus, idea, huomio tai kysymys.)
### OWASP 2021: OWASP Top 10:2021

A01:2021 – Broken Access Control (IDOR ja path traversal ovat osa tätä)

- Viallinen pääsynhallinta voi johtaa tietojen luvattomaan paljastamiseen, muokkaamiseen tai tuhoamiseen sekä toimintojen suorittamiseen käyttäjän ulkopuolella.
- Tyypillisä haavoittuvaisuuksia ovat vähimmäisoikeusperiaatteen rikkominen, URL-osoitteiden manipulointi, CORS-määritysten virheellisyys ja JWT-tunnusten väärinkäyttö.

- Ongelmia voidaan estää käyttämällä "denial of default" -politiikkaa, kirjaamalla epäonnistuneet pääsynhallintayritykset, rajoittamalla API-pyyntöjen määrää ja testaamalla pääsynhallinta mekanismit.

A10:2021 – Server-Side Request Forgery (SSRF)

- SSRF-haavoittuvuudet syntyvät verkkosovelluksen hakiessa etäresurssia ilman käyttäjän antaman URL-osoitteen validointia. Voi johtaa hyökkäyksiin järjestelmiin, joita suojataan palomuurilla tai VPN:llä.

- Ehkäisytoimia ovta "deny of default"-politiikat ja ennakoiva validointi.

- Mitkä menetelmät auttavat SSRF-haavoittuvaisuuksien tunnistamiseen?

### PortSwigget Academy:

Insecure direct object references (IDOR):

- IDOR on pääsynhallintahaavoittuvuus.
  
- Sovellus käyttää käyttäjän syöttämää tietoa resurssien suoraan käsittelemiseen.
  
- Voi johtaa horisontaaliseen tai vertikaaliseen käyttöoikeuksien laajentamiseen.
  
Path traversal:

- Path traversal haavoittuvuus mahdollistaa hyökkääjälle mielivaltaisten tiedostojen lukemisen tai kirjoittamisen palvelimella.
  
- Path traversal hyökkäyksiä voi estää välttämällä käyttäjien syöttämien tietojen välittämistä tiedostojärjestelmän rajapinnoille.
  
- Hyökkäyksiä voi estää myös käyttämällä vahvaa syötteen validointia ja sallittujen arvojen listoja.
  
Server-side request forgery (SSRF)

- Haavoittuvuus, jossa hyökkääjä voi pakottaa palvelinpuolen sovellukset tekemään pyyntöjä ei-toivottuihin kohteisiin.
  
- Hyökkäykset hyödyntävät usein luottamussuhteita ja voivat kohdistua sovelluksen isäntäpalvelimeen tai taustajärjestelmiin.
  
Cross-site scripting (XSS)

- Verkkoturvahaavoittuvuus, jossa hyökkääjä voi manipuloida haavoittuvaa sovellusta ja suorittaa haitallista JavaScript koodia uhrin selaimessa.

- Hyökkäykset mahdollistavat käyttäjän tietojen ja toimintojen kaappaamisen sekä sovelluksen täydellisen hallinnan.

- Haavoittuvuudet voidaan estää suodattamalla syötteet, koodaamalla tulosteet, käyttämällä sopivia HTTP-vastausotsikoita ja Content Security Policy-käytäntöä.

## a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Laita ZAP sieppaamaan myös kuvat, niitä tarvitaan tämän kerran kotitehtävissä. Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään. (Ei toimine localhost:lla ilman Foxyproxya)

Aloitin tehtävän lataamalla OWASP ZAP kali virtuaalikoneelle. Lataukseen käytin komento 'sudo apt-get install zaproxy'.

<img width="373" alt="Näyttökuva 2025-04-06 kello 12 12 39" src="https://github.com/user-attachments/assets/55a6d4d1-84d8-46ba-bf6c-21697940498a" />

Onnistuneen latauksen jälkeen vaihdoin kalin verkon Host Only. 

<img width="180" alt="Näyttökuva 2025-04-06 kello 12 16 00" src="https://github.com/user-attachments/assets/0c62a2f2-e009-4b4e-a1da-47d35c4d9fd3" />

Seuraavaksi luodaan sertifikaatti ZAPin kautta. Kohdasta tools ja options mennään kohtaan network ja server certificates.

<img width="489" alt="Näyttökuva 2025-04-06 kello 12 21 07" src="https://github.com/user-attachments/assets/56cb9902-4900-4eeb-ab5a-f1cf720af2a7" />

Tallensin sertifikaatin tiedostona koneelle ja avasin Firefoxin. Menin kohtaan asetukset ja tietosuoja ja turvallisuus, jonka jälkeen käytin hakusanaa certificate jonka avulla löysin sertifikaatit ja klikkasin kohtaan näytä sertifikaatit. Painamalla import napista sain valittua ZAPin luoman CA-sertifikaatin. Lopuksi vielä valitaan että sertifikaattiin luotetaan.

<img width="696" alt="Näyttökuva 2025-04-06 kello 12 27 03" src="https://github.com/user-attachments/assets/62dd042d-1e52-4004-a37c-273999857078" />

<img width="339" alt="Näyttökuva 2025-04-06 kello 12 27 54" src="https://github.com/user-attachments/assets/c49c3b4a-da8d-4d91-a49d-d6c4b97cd5da" />

Seuraavaksi asetetaan ZAP sieeppaamaan myös kuvat. Tämä tapahtui jälleen kohdasta tools ja options josta valittiin kohta display. Jotta kuvien sieppaus saadaan päälle täpättiin kohtaa Process images in HTTP request/responses.

<img width="374" alt="Näyttökuva 2025-04-06 kello 12 35 22" src="https://github.com/user-attachments/assets/960d04d9-84d9-4a1f-b9cc-d9045936c52b" />

Kävin Firefoxin asetuksissa laittamassa ZAPin selaimen välityspalvelimeksi.

<img width="593" alt="Näyttökuva 2025-04-06 kello 12 45 03" src="https://github.com/user-attachments/assets/22f262e5-98ae-4e90-8cc8-bd7fd7e42f1f" />

Käynnistin seuraavaksi Metsploitable virtuaalikoneen, jotta voin kokeilla ZAPia. Varmistin yhteyden koneiden välillä käyttämällä komentoa 'ping 192.168.56.2'. Seuraavaksi kirjoitin Metasploitablen osoitteen selaimeen ja Metasploitablen sivu aukesi. Nyt kun siirryin takaisin ZAP ikkunaan oli sinne tullut liikennettä. Kuvien toimivuutta ei voinut vielä tässä harjoituksessa kokeilla. 

<img width="590" alt="Näyttökuva 2025-04-06 kello 12 53 07" src="https://github.com/user-attachments/assets/cd5c85a7-23a3-4ea6-ab16-fc607c3af6db" />

## b) Kettumaista. Asenna "FoxyProxy Standard" Firefox Addon, ja lisää ZAP proxyksi siihen. Käytä FoxyProxyn "Patterns" -toimintoa, niin että vain valitsemasi weppisivut ohjataan Proxyyn. (Läksyssä ohjataan varmaankin PortSwigger Labs ja localhost.)PortSwigger Labs. Ratkaise tehtävät. Selitä ratkaisusi: mitä palvelimella tapahtuu, mitä eri osat tekevät, miten hyökkäys löytyi, mistä vika johtuu. Kannattaa käyttää ZAPia, vaikka malliratkaisut käyttävät harjoitusten tekijän maksullista ohjelmaa. Monet tehtävät voi ratkaista myös pelkällä selaimella. Malliratkaisun kopioiminen ZAP:n tai selaimeen ei ole vastaus tehtävään, vaan ratkaisu ja haavoittuvuuden etsiminen on selitettävä ja perusteltava.

Minulla oli alkuun ongelmia tehtävän kanssa sillä kun kytkin NAT verkon päälle ja tarkistin ping kautta että saan yhteyden verkkoon se toimi mutta verkkoselain ei toiminut. Tämä johtui ZAP proxysta ja jouduin asetuksista vaihtamaan proxyn pois päältä. 

<img width="382" alt="Näyttökuva 2025-04-07 kello 10 24 03" src="https://github.com/user-attachments/assets/1aa27517-094f-4837-a9d9-b7909504d7d7" />

Seuraavaksi latasin FoxyProxy Standardin. Kun lataus oli valmis poistin koneen verkosta, niin että se oli enään yhteydessä Metasploit virtuaalikoneeseen verkon Host Only kautta. 

<img width="702" alt="Näyttökuva 2025-04-07 kello 10 27 24" src="https://github.com/user-attachments/assets/d73e4de6-2ca5-45ac-962f-e4bb69d28a0f" />

Lisätään FoxyProxyn asetuksista ZAP-proxy FoxyProxyyn. Alla olevassa kuvassa näkyy myös pattern, johon lisäsin localhostin. Pattern-toiminnon kautta voimme määrittää tietyt verkkosivut proxyn läpi. 

<img width="699" alt="Näyttökuva 2025-04-07 kello 10 41 33" src="https://github.com/user-attachments/assets/e459f2c4-2f39-4936-82c9-104a6e371d81" />


## Cross Site Scripting (XSS)

### c) Reflected XSS into HTML context with nothing encoded

Aloitin tehtävän kirjoittamalla search boxiin alert niin kuin tehtävän annossa käskettiin. Mitään ei kuitenkaan tapahtunut joten avasin sivuston lähdekoodin. Etsin kohdan alert koodista ja se oli laitettu <h1></h1> muotoon. Tämän vuoksi kun hakukenttään kirjoitettiin alert ei tapahtunut mitään, sillä h1 käsittelee sen vain tekstinä. 

<img width="1413" alt="Näyttökuva 2025-04-07 kello 11 04 58" src="https://github.com/user-attachments/assets/3bdb33ec-3cb4-4dcc-820e-1e1ab2a1f0ad" />

Kirjoitin hakukenttään seuraavaksi <script>alert(1)</script> ja painoin search ja nyt funktio toteutui, sillä script käskee selainta suorittamaan koodin. 

<img width="529" alt="Näyttökuva 2025-04-07 kello 11 06 15" src="https://github.com/user-attachments/assets/723375c3-714f-4c76-998a-393d0cb73e80" />

Nyt ensimmäinen labra on valmis.

<img width="313" alt="Näyttökuva 2025-04-07 kello 11 09 10" src="https://github.com/user-attachments/assets/054812ba-b9d4-4add-82bb-a32f7f350fbe" />

### d) Stored XSS into HTML context with nothing encoded

Tehtävän tarkoituksena oli lähettää kommentti joka kutsuu samaa alert-funktiota, kuin äsken tehdyssä c tehtävässäkin. Aloitin tehtävän avaamalla blogi kirjoituksen ja kokeilin kirjoittaa siihen kommentin.

<img width="844" alt="Näyttökuva 2025-04-07 kello 11 22 33" src="https://github.com/user-attachments/assets/a29c68e8-41cb-4b97-bbee-3a731449f862" />

<img width="721" alt="Näyttökuva 2025-04-07 kello 11 27 05" src="https://github.com/user-attachments/assets/69900569-a85b-4cc1-ae52-b70680be44ce" />

Kun olin julkaissut kommenttini avasin sivun lähdekoodin jota tarkastelemalla huomasin että kommenttini löytyi koodista <p></p> sisältä. Päätin kokeilla seuraavaksi mitä tapahtuu, jos kirjoitan kommentti kenttään suoraan <script>alert(1)</script> komennon.

<img width="763" alt="Näyttökuva 2025-04-07 kello 11 33 04" src="https://github.com/user-attachments/assets/b59adefa-1952-42a5-b366-c2f8648fe0f3" />

Kun palasin takaisin blogi kirjoitukseen suoritettiin alert-funktio.

<img width="459" alt="Näyttökuva 2025-04-07 kello 11 33 16" src="https://github.com/user-attachments/assets/b3d1880b-be58-4260-be10-38fe2f12205d" />

Tehtävä on nyt suoritettu.

<img width="1175" alt="Näyttökuva 2025-04-07 kello 11 36 05" src="https://github.com/user-attachments/assets/fe4bf515-b3cf-4722-845e-e331195255e8" />


## Path traversal

### e) File path traversal, simple case. Laita tarvittaessa Zapissa kuvien sieppaus päälle.

### f) File path traversal, traversal sequences blocked with absolute path bypass

### g) File path traversal, traversal sequences stripped non-recursively

## Insecure Direct Object Reference (IDOR)

### h) Insecure direct object references

## Server Side Request Forgery (SSRF)
### i) Basic SSRF against the local server

## Lähteet:

https://portswigger.net/web-security/cross-site-scripting

https://terokarvinen.com/tunkeutumistestaus/#h2-taysin-laillinen-sertifikaatti

https://owasp.org/Top10/A01_2021-Broken_Access_Control/

https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/

https://portswigger.net/web-security/access-control/idor

https://portswigger.net/web-security/file-path-traversal

https://portswigger.net/web-security/ssrf

