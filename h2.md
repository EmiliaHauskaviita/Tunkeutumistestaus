# h2 Täysin Laillinen Sertifikaatti

## x) Lue/katso ja tiivistä. (Tässä x-alakohdassa ei tarvitse tehdä testejä tietokoneella, vain lukeminen tai kuunteleminen ja tiivistelmä riittää. Tiivistämiseen riittää muutama ranskalainen viiva kustakin artikkelista. Kannattaa lisätä myös jokin oma ajatus, idea, huomio tai kysymys.)
### OWASP 2021: OWASP Top 10:2021

A01:2021 – Broken Access Control (IDOR ja path traversal ovat osa tätä)

- Viallinen pääsynhallinta voi johtaa tietojen luvattomaan paljastamiseen, muokkaamiseen tai tuhoamiseen sekä toimintojen suorittamiseen käyttäjän ulkopuolella.
- Tyypillisä haavoittuvaisuuksia ovat vähimmäisoikeusperiaatteen rikkominen, URL-osoitteiden manipulointi, CORS-määritysten virheellisyys ja JWT-tunnusten väärinkäyttö.

- Ongelmia voidaan estää käyttämällä "denial of default" -politiikkaa, kirjaamalla epäonnistuneet pääsynhallintayritykset, rajoittamalla API-pyyntöjen määrää ja testaamalla pääsynhallinta mekanismit.

A10:2021 – Server-Side Request Forgery (SSRF)

- SSRF-haavoittuvuudet syntyvät verkkosovelluksen hakiessa etäresurssia ilman käyttäjän antaman URL-osoitteen validointia. Voi johtaa hyökkäyksiin järjestelmiin, joita suojataan palomuurilla tai VPN:llä.

- Ehkäisytoimia ovta "deny of default"-politiikat ja ennakoiva validointi.

- Mitkä menetelmät auttavat SSRF-haavoittuvaisuuksien tunnistamiseen?

### PortSwigget Academy:

Insecure direct object references (IDOR):

- IDOR on pääsynhallintahaavoittuvuus.
  
- Sovellus käyttää käyttäjän syöttämää tietoa resurssien suoraan käsittelemiseen.
  
- Voi johtaa horisontaaliseen tai vertikaaliseen käyttöoikeuksien laajentamiseen.
  
Path traversal:

- Path traversal haavoittuvuus mahdollistaa hyökkääjälle mielivaltaisten tiedostojen lukemisen tai kirjoittamisen palvelimella.
  
- Path traversal hyökkäyksiä voi estää välttämällä käyttäjien syöttämien tietojen välittämistä tiedostojärjestelmän rajapinnoille.
  
- Hyökkäyksiä voi estää myös käyttämällä vahvaa syötteen validointia ja sallittujen arvojen listoja.
  
Server-side request forgery (SSRF)

- Haavoittuvuus, jossa hyökkääjä voi pakottaa palvelinpuolen sovellukset tekemään pyyntöjä ei-toivottuihin kohteisiin.
  
- Hyökkäykset hyödyntävät usein luottamussuhteita ja voivat kohdistua sovelluksen isäntäpalvelimeen tai taustajärjestelmiin.
  
Cross-site scripting (XSS)

- Verkkoturvahaavoittuvuus, jossa hyökkääjä voi manipuloida haavoittuvaa sovellusta ja suorittaa haitallista JavaScript koodia uhrin selaimessa.

- Hyökkäykset mahdollistavat käyttäjän tietojen ja toimintojen kaappaamisen sekä sovelluksen täydellisen hallinnan.

- Haavoittuvuudet voidaan estää suodattamalla syötteet, koodaamalla tulosteet, käyttämällä sopivia HTTP-vastausotsikoita ja Content Security Policy-käytäntöä.

## a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Laita ZAP sieppaamaan myös kuvat, niitä tarvitaan tämän kerran kotitehtävissä. Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään. (Ei toimine localhost:lla ilman Foxyproxya)

Aloitin tehtävän lataamalla OWASP ZAP kali virtuaalikoneelle. Lataukseen käytin komento 'sudo apt-get install zaproxy'.

<img width="373" alt="Näyttökuva 2025-04-06 kello 12 12 39" src="https://github.com/user-attachments/assets/55a6d4d1-84d8-46ba-bf6c-21697940498a" />

Onnistuneen latauksen jälkeen vaihdoin kalin verkon Host Only. 

<img width="180" alt="Näyttökuva 2025-04-06 kello 12 16 00" src="https://github.com/user-attachments/assets/0c62a2f2-e009-4b4e-a1da-47d35c4d9fd3" />

Seuraavaksi luodaan sertifikaatti ZAPin kautta. Kohdasta tools ja options mennään kohtaan network ja server certificates.

<img width="489" alt="Näyttökuva 2025-04-06 kello 12 21 07" src="https://github.com/user-attachments/assets/56cb9902-4900-4eeb-ab5a-f1cf720af2a7" />

Tallensin sertifikaatin tiedostona koneelle ja avasin Firefoxin. Menin kohtaan asetukset ja tietosuoja ja turvallisuus, jonka jälkeen käytin hakusanaa certificate jonka avulla löysin sertifikaatit ja klikkasin kohtaan näytä sertifikaatit. Painamalla import napista sain valittua ZAPin luoman CA-sertifikaatin. Lopuksi vielä valitaan että sertifikaattiin luotetaan.

<img width="696" alt="Näyttökuva 2025-04-06 kello 12 27 03" src="https://github.com/user-attachments/assets/62dd042d-1e52-4004-a37c-273999857078" />

<img width="339" alt="Näyttökuva 2025-04-06 kello 12 27 54" src="https://github.com/user-attachments/assets/c49c3b4a-da8d-4d91-a49d-d6c4b97cd5da" />

Seuraavaksi asetetaan ZAP sieeppaamaan myös kuvat. Tämä tapahtui jälleen kohdasta tools ja options josta valittiin kohta display. Jotta kuvien sieppaus saadaan päälle täpättiin kohtaa Process images in HTTP request/responses.

<img width="374" alt="Näyttökuva 2025-04-06 kello 12 35 22" src="https://github.com/user-attachments/assets/960d04d9-84d9-4a1f-b9cc-d9045936c52b" />

Kävin Firefoxin asetuksissa laittamassa ZAPin selaimen välityspalvelimeksi.

<img width="593" alt="Näyttökuva 2025-04-06 kello 12 45 03" src="https://github.com/user-attachments/assets/22f262e5-98ae-4e90-8cc8-bd7fd7e42f1f" />

Käynnistin seuraavaksi Metsploitable virtuaalikoneen, jotta voin kokeilla ZAPia. Varmistin yhteyden koneiden välillä käyttämällä komentoa 'ping 192.168.56.2'. Seuraavaksi kirjoitin Metasploitablen osoitteen selaimeen ja Metasploitablen sivu aukesi. Nyt kun siirryin takaisin ZAP ikkunaan oli sinne tullut liikennettä. Kuvien toimivuutta ei voinut vielä tässä harjoituksessa kokeilla. 

<img width="590" alt="Näyttökuva 2025-04-06 kello 12 53 07" src="https://github.com/user-attachments/assets/cd5c85a7-23a3-4ea6-ab16-fc607c3af6db" />

## b) Kettumaista. Asenna "FoxyProxy Standard" Firefox Addon, ja lisää ZAP proxyksi siihen. Käytä FoxyProxyn "Patterns" -toimintoa, niin että vain valitsemasi weppisivut ohjataan Proxyyn. (Läksyssä ohjataan varmaankin PortSwigger Labs ja localhost.)PortSwigger Labs. Ratkaise tehtävät. Selitä ratkaisusi: mitä palvelimella tapahtuu, mitä eri osat tekevät, miten hyökkäys löytyi, mistä vika johtuu. Kannattaa käyttää ZAPia, vaikka malliratkaisut käyttävät harjoitusten tekijän maksullista ohjelmaa. Monet tehtävät voi ratkaista myös pelkällä selaimella. Malliratkaisun kopioiminen ZAP:n tai selaimeen ei ole vastaus tehtävään, vaan ratkaisu ja haavoittuvuuden etsiminen on selitettävä ja perusteltava.

## Cross Site Scripting (XSS)

### c) Reflected XSS into HTML context with nothing encoded

### d) Stored XSS into HTML context with nothing encoded

## Path traversal

### e) File path traversal, simple case. Laita tarvittaessa Zapissa kuvien sieppaus päälle.

### f) File path traversal, traversal sequences blocked with absolute path bypass

### g) File path traversal, traversal sequences stripped non-recursively

## Insecure Direct Object Reference (IDOR)

### h) Insecure direct object references

## Server Side Request Forgery (SSRF)
### i) Basic SSRF against the local server

## Lähteet:

https://portswigger.net/web-security/cross-site-scripting

https://terokarvinen.com/tunkeutumistestaus/#h2-taysin-laillinen-sertifikaatti

https://owasp.org/Top10/A01_2021-Broken_Access_Control/

https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/

https://portswigger.net/web-security/access-control/idor

https://portswigger.net/web-security/file-path-traversal

https://portswigger.net/web-security/ssrf

